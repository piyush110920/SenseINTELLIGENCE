<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SENSEintelligence - Customer Support</title>
    <link rel="stylesheet" href="/static/style.css" id="theme-style">
</head>
<body class="dark">
    <div class="main-container">
        <div class="header">
            <h1>SENSEintelligence</h1>
            <p>Customer Support Chatbot</p>
            <button id="mode-toggle">Switch to Light Mode</button>
        </div>

        <div class="chat-container" id="chat-box">
            <!-- Chat messages will appear here -->
        </div>

        <div class="input-container">
            <input type="text" id="user-input" placeholder="Type your question..." autocomplete="off" />
            <button id="send-btn">Send</button>
        </div>
    </div>

    <script>
        const chatBox = document.getElementById("chat-box");
        const inputBox = document.getElementById("user-input");
        const sendBtn = document.getElementById("send-btn");

        function appendMessage(sender, text) {
            const messageDiv = document.createElement("div");
            messageDiv.classList.add("message", sender);
            messageDiv.innerHTML = `<strong>${sender === "user" ? "You" : "Bot"}:</strong> ${text}`;
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        async function sendMessage() {
            const userMsg = inputBox.value.trim();
            if (!userMsg) return;

            appendMessage("user", userMsg);
            inputBox.value = "";
            inputBox.disabled = true;
            sendBtn.disabled = true;

            try {
                const res = await fetch("/ask", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ message: userMsg })
                });

                const data = await res.json();
                appendMessage("bot", data.response);
            } catch (error) {
                appendMessage("bot", "⚠️ Unable to fetch response.");
            } finally {
                inputBox.disabled = false;
                sendBtn.disabled = false;
                inputBox.focus();
            }
        }

        inputBox.addEventListener("keydown", e => {
            if (e.key === "Enter") sendMessage();
        });

        sendBtn.addEventListener("click", sendMessage);

        // Mode toggle logic
        const modeToggle = document.getElementById("mode-toggle");
        const themeStyle = document.getElementById("theme-style");

        modeToggle.addEventListener("click", () => {
            if (themeStyle.getAttribute("href").includes("style.css")) {
                themeStyle.setAttribute("href", "/static/light.css");
                modeToggle.textContent = "Switch to Dark Mode";
            } else {
                themeStyle.setAttribute("href", "/static/style.css");
                modeToggle.textContent = "Switch to Light Mode";
            }
        });
    </script>
</body>
</html>
